:root {
  --bg0: #f4f7ff;
  --bg1: #ffffff;
  --fg0: #0b1220;
  --fg1: #334155;
  --muted: #64748b;
  --border: rgba(15, 23, 42, 0.14);
  --borderSoft: rgba(15, 23, 42, 0.09);
  --shadowSm: 0 6px 18px rgba(15, 23, 42, 0.08);
  --shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
  --shadowLg: 0 26px 70px rgba(15, 23, 42, 0.18);
  --accent: #2563eb;
  --accent2: #06b6d4;
  --tagBg: rgba(6, 182, 212, 0.11);
  --tagFg: #0e7490;
  --danger: #d1242f;
  --glassClear: rgba(255, 255, 255, 0);

  --radius: 12px;
  --radiusSm: 10px;

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans: "SF Pro Display", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Noto Sans JP",
    "Helvetica Neue", sans-serif;
}

* {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
}

body {
  margin: 0;
  font-family: var(--sans);
  color: var(--fg0);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  background-color: var(--bg0);
  background-image: linear-gradient(180deg, #eef4ff 0%, #f7faff 52%, #f3f7fd 100%);
}

::selection {
  background: rgba(6, 182, 212, 0.22);
  color: var(--fg0);
  text-shadow: none;
}

button,
input,
textarea,
select {
  font-family: inherit;
}

button:focus-visible,
a:focus-visible {
  outline: 2px solid rgba(37, 99, 235, 0.55);
  outline-offset: 3px;
}

/* scrollbars (Chromium/Electron) */
*::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

*::-webkit-scrollbar-thumb {
  background: rgba(15, 23, 42, 0.18);
  border-radius: 999px;
  border: 3px solid rgba(255, 255, 255, 0.65);
}

*::-webkit-scrollbar-thumb:hover {
  background: rgba(15, 23, 42, 0.24);
}

*::-webkit-scrollbar-track {
  background: transparent;
}

/* app shell */
.shell {
  display: grid;
  grid-template-columns: 270px 1fr;
  height: 100vh;
}

.sidebar {
  border-right: 1px solid var(--borderSoft);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.08));
  backdrop-filter: blur(40px) saturate(1.35);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.32);
  padding: 18px 14px;
  overflow: auto;
}

.main {
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.topbar {
  display: grid;
  grid-template-columns: 1fr minmax(300px, 520px) 1fr;
  gap: 18px;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--borderSoft);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.22), rgba(255, 255, 255, 0.08));
  backdrop-filter: blur(40px) saturate(1.35);
  box-shadow: 0 12px 30px rgba(15, 23, 42, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.3);
  /* Allow dragging the window on macOS when using titleBarStyle hidden/hiddenInset. */
  -webkit-app-region: drag;
}

.topbar button,
.topbar input,
.topbar textarea,
.topbar select,
.topbar a {
  -webkit-app-region: no-drag;
}

.topbarLeft {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.appTitle {
  font-weight: 760;
  letter-spacing: -0.02em;
  font-size: 18px;
}

.viewTabs {
  margin-top: 8px;
  display: inline-flex;
  gap: 8px;
}

.viewTab {
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.88);
  color: var(--fg1);
  border-radius: 999px;
  padding: 4px 10px;
  font-size: 12px;
  cursor: pointer;
}

.viewTab.isActive {
  color: var(--accent);
  border-color: rgba(37, 99, 235, 0.24);
  background: rgba(37, 99, 235, 0.08);
}

.topbarCenter {
  display: flex;
  justify-content: center;
}

.topbarControls {
  width: 100%;
  max-width: 720px;
  display: flex;
  gap: 12px;
  align-items: center;
}

.aiTopHint {
  font-size: 12px;
  color: var(--muted);
}

.topbarRight {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 2px;
  min-width: 0;
}

.dataDirLabel {
  font-size: 11px;
  color: var(--muted);
}

.dataDirHeader {
  display: flex;
  gap: 10px;
  align-items: center;
}

.dataDirValue {
  font-size: 12px;
  color: var(--fg1);
  max-width: 340px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.search {
  position: relative;
  width: 100%;
  max-width: 520px;
}

.searchInput {
  width: 100%;
  height: 40px;
  padding: 0 44px 0 14px;
  border-radius: 999px;
  border: 1px solid var(--borderSoft);
  background: rgba(255, 255, 255, 0.54);
  backdrop-filter: blur(24px) saturate(1.2);
  box-shadow: 0 1px 0 rgba(15, 23, 42, 0.02), inset 0 1px 0 rgba(255, 255, 255, 0.62);
  font-size: 14px;
  outline: none;
  transition: box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.searchInput:focus {
  border-color: rgba(37, 99, 235, 0.55);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
}

.searchClear {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 30px;
  height: 30px;
  border-radius: 999px;
  border: 0;
  background: rgba(15, 23, 42, 0.06);
  color: var(--fg1);
  cursor: pointer;
}

.searchClear:hover {
  background: rgba(15, 23, 42, 0.1);
}

.limitPicker {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--borderSoft);
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(24px) saturate(1.2);
  height: 40px;
}

.limitLabel {
  font-size: 12px;
  color: var(--muted);
  font-weight: 720;
}

.datePicker {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid var(--borderSoft);
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(24px) saturate(1.2);
  height: 40px;
}

.dateLabel {
  font-size: 12px;
  color: var(--muted);
  font-weight: 720;
}

.dateInput {
  border: 0;
  background: transparent;
  outline: none;
  font-size: 13px;
  color: var(--fg1);
  cursor: pointer;
  height: 28px;
}

.dateNavBtn {
  width: 30px;
  height: 30px;
  border-radius: 999px;
  border: 0;
  background: rgba(15, 23, 42, 0.06);
  color: var(--fg1);
  cursor: pointer;
}

.dateNavBtn:hover {
  background: rgba(15, 23, 42, 0.1);
}

.dateNavBtn:disabled {
  opacity: 0.45;
  cursor: default;
}

.dateQuickBtn,
.dateClearBtn {
  height: 30px;
  border-radius: 999px;
  border: 0;
  background: rgba(15, 23, 42, 0.06);
  color: var(--fg1);
  cursor: pointer;
  font-size: 12px;
  padding: 0 10px;
}

.dateQuickBtn:hover,
.dateClearBtn:hover {
  background: rgba(15, 23, 42, 0.1);
}

.limitSelect {
  border: 0;
  background: transparent;
  outline: none;
  font-size: 13px;
  color: var(--fg1);
  cursor: pointer;
}

.ghostBtn {
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.14);
  backdrop-filter: blur(18px) saturate(1.15);
  color: var(--fg1);
  padding: 4px 10px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 12px;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.ghostBtn:hover {
  background: rgba(255, 255, 255, 0.22);
  transform: translateY(-1px);
}

.scrollArea {
  flex: 1;
  overflow: auto;
  padding: 20px 20px 0;
}

.dragScroll:hover {
  cursor: grab;
}

.dragScroll .md {
  cursor: text;
}

.dragScroll.isDragScrolling,
.dragScroll.isDragScrolling * {
  cursor: grabbing !important;
}

.dragScrollNoSelect,
.dragScrollNoSelect * {
  user-select: none !important;
}

.commentList {
  display: flex;
  flex-direction: column;
  gap: 14px;
  padding-bottom: 18px;
}

.empty {
  padding: 30px 12px;
  color: var(--muted);
  text-align: center;
}

/* tag sidebar */
.tagSidebarTitle {
  font-size: 12px;
  font-weight: 720;
  color: var(--muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  margin: 4px 8px 10px;
}

.tagSearch {
  position: relative;
  margin: 0 6px 10px;
}

.tagSearchInput {
  width: 100%;
  height: 34px;
  padding: 0 36px 0 12px;
  border-radius: 12px;
  border: 1px solid var(--borderSoft);
  background: rgba(255, 255, 255, 0.54);
  backdrop-filter: blur(24px) saturate(1.2);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.62);
  font-size: 13px;
  outline: none;
  transition: box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.tagSearchInput:focus {
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
}

.tagSearchClear {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  width: 26px;
  height: 26px;
  border-radius: 10px;
  border: 0;
  background: rgba(15, 23, 42, 0.06);
  color: var(--fg1);
  cursor: pointer;
}

.tagSearchClear:hover {
  background: rgba(15, 23, 42, 0.1);
}

.tagItem {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  border: 1px solid transparent;
  background: transparent;
  border-radius: 12px;
  padding: 10px 10px 10px 14px;
  cursor: pointer;
  color: var(--fg1);
  position: relative;
  transition: background 140ms ease, border-color 140ms ease, transform 140ms ease;
}

.tagItem:hover {
  background: rgba(255, 255, 255, 0.14);
  border-color: rgba(15, 23, 42, 0.08);
  transform: translateY(-1px);
}

.tagItem.isSelected {
  background: rgba(37, 99, 235, 0.1);
  border-color: rgba(37, 99, 235, 0.18);
  color: var(--accent);
  transform: translateY(-1px);
}

.tagItem.isSelected::before {
  content: "";
  position: absolute;
  left: 6px;
  top: 8px;
  bottom: 8px;
  width: 3px;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(6, 182, 212, 0.95), rgba(37, 99, 235, 0.95));
  box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.06);
}

.tagName {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
}

.tagCount {
  font-size: 12px;
  color: var(--muted);
  border: 1px solid rgba(15, 23, 42, 0.08);
  background: rgba(15, 23, 42, 0.04);
  padding: 2px 8px;
  border-radius: 999px;
}

.tagItem.isSelected .tagCount {
  border-color: rgba(37, 99, 235, 0.16);
  background: rgba(37, 99, 235, 0.12);
  color: var(--accent);
}

.tagDivider {
  height: 1px;
  background: rgba(15, 23, 42, 0.08);
  margin: 10px 6px;
}

.tagEmpty {
  padding: 10px 10px;
  color: var(--muted);
  font-size: 13px;
}

.tagGroup {
  margin: 0 0 10px;
}

.tagGroupHeader {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(15, 23, 42, 0.08);
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(22px) saturate(1.2);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.28);
  border-radius: 12px;
  padding: 8px 10px 8px 12px;
  cursor: pointer;
  color: var(--fg1);
  transition: background 140ms ease, border-color 140ms ease, transform 140ms ease;
}

.tagGroupHeader:hover {
  background: rgba(255, 255, 255, 0.18);
  border-color: rgba(15, 23, 42, 0.1);
  transform: translateY(-1px);
}

.tagGroupHeader::before {
  content: "";
  width: 8px;
  height: 8px;
  border-right: 2px solid rgba(15, 23, 42, 0.44);
  border-bottom: 2px solid rgba(15, 23, 42, 0.44);
  transform: rotate(-45deg);
  border-radius: 1px;
}

.tagGroupHeader.isOpen::before {
  transform: rotate(45deg);
}

.tagGroupHeader.isActive {
  background: rgba(37, 99, 235, 0.08);
  border-color: rgba(37, 99, 235, 0.18);
}

.tagGroupHeader.isActive::before {
  border-right-color: rgba(37, 99, 235, 0.7);
  border-bottom-color: rgba(37, 99, 235, 0.7);
}

.tagGroupHeader.isActive .tagGroupName {
  color: var(--accent);
}

.tagGroupHeader.isActive .tagCount {
  border-color: rgba(37, 99, 235, 0.16);
  background: rgba(37, 99, 235, 0.12);
  color: var(--accent);
}

.tagGroupName {
  flex: 1;
  text-align: left;
  font-size: 12px;
  font-weight: 760;
  color: var(--fg1);
  letter-spacing: 0.03em;
}

.tagGroup .tagItem {
  padding-left: 26px;
}

.tagGroup .tagItem.isSelected::before {
  left: 18px;
}

/* comment cards */
.commentCard {
  border-radius: var(--radius);
  border: 1px solid transparent;
  background: linear-gradient(rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.08)) padding-box,
    linear-gradient(135deg, rgba(6, 182, 212, 0.35), rgba(37, 99, 235, 0.2), rgba(61, 190, 150, 0.18))
      border-box;
  box-shadow: var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.3);
  overflow: hidden;
  backdrop-filter: blur(36px) saturate(1.3);
  animation: riseIn 220ms ease-out both;
  transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
}

.commentCard:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow), inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

@keyframes riseIn {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.commentHeader {
  display: flex;
  gap: 12px;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(15, 23, 42, 0.08);
  background: linear-gradient(to bottom, rgba(255, 255, 255, 0.22), rgba(255, 255, 255, 0.1));
}

.commentHeaderMain {
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-width: 0;
}

.commentHeaderLine1 {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 12px;
}

.commentHeaderRight {
  display: flex;
  gap: 10px;
  align-items: center;
}

.commentMeta {
  display: flex;
  gap: 10px;
  color: var(--muted);
  font-size: 12px;
  white-space: nowrap;
}

.dangerGhostBtn {
  border: 1px solid rgba(209, 36, 47, 0.22);
  background: rgba(255, 255, 255, 0.14);
  backdrop-filter: blur(18px) saturate(1.15);
  color: #8a0f19;
  padding: 4px 10px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 12px;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.dangerGhostBtn:hover {
  background: rgba(209, 36, 47, 0.08);
  transform: translateY(-1px);
}

.commentTags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tagPill {
  border: 1px solid rgba(6, 182, 212, 0.22);
  background: var(--tagBg);
  color: var(--tagFg);
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  cursor: pointer;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.tagPill:hover {
  background: rgba(6, 182, 212, 0.16);
  transform: translateY(-1px);
}

.commentBody {
  padding: 14px 16px;
}

/* markdown-ish */
.md {
  line-height: 1.7;
  color: var(--fg0);
  font-size: 14px;
  tab-size: 2;
  -moz-tab-size: 2;
}

.md ul,
.md ol {
  /* Browser default indent is wide; keep nested lists compact. */
  padding-left: 1.4em;
  padding-inline-start: 1.4em;
}

.md pre,
.md code {
  font-family: var(--mono);
  tab-size: 2;
  -moz-tab-size: 2;
}

.md pre {
  background: var(--theme-code-bg);
  border: 1px solid var(--theme-code-border);
  border-radius: var(--radiusSm);
  padding: 12px;
  overflow: auto;
}

.md pre.hljs {
  background: var(--theme-code-bg) !important;
  border-color: var(--theme-code-border) !important;
  color: var(--theme-code-fg) !important;
}

.md pre.hljs code.hljs {
  background: transparent !important;
  padding: 0 !important;
  color: var(--theme-code-fg) !important;
}

.md :not(pre) > code {
  background: var(--theme-code-bg-soft);
  border: 1px solid var(--theme-code-border);
  padding: 2px 5px;
  border-radius: 6px;
}

.md pre.hljs .hljs-comment,
.md pre.hljs .hljs-quote,
.md pre.hljs .hljs-code,
.md pre.hljs .hljs-formula {
  color: var(--theme-code-muted) !important;
}

.md pre.hljs .hljs-keyword,
.md pre.hljs .hljs-doctag,
.md pre.hljs .hljs-template-tag,
.md pre.hljs .hljs-meta .hljs-keyword,
.md pre.hljs .hljs-type,
.md pre.hljs .hljs-variable.language_ {
  color: var(--theme-code-keyword) !important;
}

.md pre.hljs .hljs-title,
.md pre.hljs .hljs-title.class_,
.md pre.hljs .hljs-title.class_.inherited__,
.md pre.hljs .hljs-title.function_ {
  color: var(--theme-code-title) !important;
}

.md pre.hljs .hljs-attr,
.md pre.hljs .hljs-attribute,
.md pre.hljs .hljs-literal,
.md pre.hljs .hljs-meta,
.md pre.hljs .hljs-number,
.md pre.hljs .hljs-operator,
.md pre.hljs .hljs-variable,
.md pre.hljs .hljs-selector-attr,
.md pre.hljs .hljs-selector-class,
.md pre.hljs .hljs-selector-id,
.md pre.hljs .hljs-link,
.md pre.hljs .hljs-property,
.md pre.hljs .hljs-params,
.md pre.hljs .hljs-punctuation,
.md pre.hljs .hljs-char.escape_ {
  color: var(--theme-code-literal) !important;
}

.md pre.hljs .hljs-regexp,
.md pre.hljs .hljs-string,
.md pre.hljs .hljs-meta .hljs-string {
  color: var(--theme-code-string) !important;
}

.md pre.hljs .hljs-built_in,
.md pre.hljs .hljs-symbol,
.md pre.hljs .hljs-bullet {
  color: var(--theme-code-builtin) !important;
}

.md pre.hljs .hljs-name,
.md pre.hljs .hljs-selector-tag,
.md pre.hljs .hljs-selector-pseudo,
.md pre.hljs .hljs-tag {
  color: var(--theme-code-tag) !important;
}

.md pre.hljs .hljs-section {
  color: var(--theme-code-title) !important;
  font-weight: 700;
}

.md pre.hljs .hljs-subst,
.md pre.hljs .hljs-emphasis,
.md pre.hljs .hljs-strong {
  color: var(--theme-code-fg) !important;
}

.md pre.hljs .hljs-addition {
  color: var(--theme-code-addition) !important;
  background-color: var(--theme-code-addition-bg) !important;
}

.md pre.hljs .hljs-deletion {
  color: var(--theme-code-deletion) !important;
  background-color: var(--theme-code-deletion-bg) !important;
}

.md li.taskListItem {
  list-style: none;
}

.md input.taskListCheckbox {
  accent-color: var(--accent);
  cursor: pointer;
}

.md li.taskListItem > input.taskListCheckbox {
  margin: 0 0.5em 0.14em -1.28em;
  vertical-align: middle;
}

.md li.taskStatePartial > input.taskListCheckbox {
  accent-color: #d97706;
}

.md li.taskStateReview > input.taskListCheckbox {
  accent-color: #0284c7;
}

.md .taskStateBadge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 1.22em;
  height: 1.22em;
  margin-right: 0.42em;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 700;
  line-height: 1;
  vertical-align: middle;
}

.md .taskStateBadgeReview {
  color: #0369a1;
  background: rgba(14, 116, 144, 0.12);
  border: 1px solid rgba(14, 116, 144, 0.28);
}

.md .mermaid {
  background: rgba(15, 23, 42, 0.05);
  border: 1px solid rgba(15, 23, 42, 0.08);
  border-radius: var(--radiusSm);
  padding: 12px;
  overflow: auto;
}

.md .mermaid svg {
  max-width: 100%;
  height: auto;
  display: block;
}

.md a {
  color: var(--accent);
  text-decoration: none;
}

.md a:hover {
  text-decoration: underline;
}

.md blockquote {
  margin: 0;
  padding: 0 0 0 12px;
  border-left: 3px solid rgba(15, 23, 42, 0.16);
  color: var(--fg1);
}

.md hr {
  border: 0;
  border-top: 1px solid rgba(15, 23, 42, 0.12);
  margin: 16px 0;
}

/* composer */
.composerArea {
  border-bottom: 1px solid var(--borderSoft);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.08));
  backdrop-filter: blur(40px) saturate(1.35);
  padding: 14px 20px 18px;
  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.28);
}

.aiArea {
  flex: 1;
  min-height: 0;
  padding: 14px 20px 18px;
}

.aiArea.isHidden {
  display: none;
}

.aiConsole {
  position: relative;
  isolation: isolate;
  overflow: hidden;
  height: 100%;
  min-height: 520px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  border: 1px solid rgba(37, 99, 235, 0.2);
  border-radius: 18px;
  background:
    radial-gradient(1200px 360px at -8% -24%, rgba(37, 99, 235, 0.24), rgba(37, 99, 235, 0) 62%),
    radial-gradient(900px 320px at 110% -20%, rgba(6, 182, 212, 0.22), rgba(6, 182, 212, 0) 65%),
    linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(246, 250, 255, 0.88));
  box-shadow: 0 24px 52px rgba(15, 23, 42, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.76);
  padding: 14px;
}

.aiConsole::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.28), rgba(255, 255, 255, 0));
}

.aiConsole > * {
  position: relative;
  z-index: 1;
}

.aiConsoleHeader {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 10px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.66);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.72);
  backdrop-filter: blur(18px) saturate(1.22);
  padding: 10px 12px;
}

.aiConsoleTitle {
  font-size: 15px;
  font-weight: 800;
  letter-spacing: -0.02em;
}

.aiConsoleStatus {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: var(--muted);
  padding: 3px 9px;
  border-radius: 999px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.74);
}

.aiConsoleStatus.isLive {
  color: #0f766e;
  border-color: rgba(15, 118, 110, 0.34);
  background: rgba(15, 118, 110, 0.12);
}

.aiThinking {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--muted);
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(15, 23, 42, 0.03);
}

.aiThinking.isActive {
  color: #1d4ed8;
  border-color: rgba(37, 99, 235, 0.28);
  background: rgba(37, 99, 235, 0.08);
}

.aiThinkingDot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: currentColor;
  opacity: 0.35;
}

.aiThinking.isActive .aiThinkingDot {
  animation: aiThinkingPulse 1100ms ease-in-out infinite;
  opacity: 1;
}

@keyframes aiThinkingPulse {
  0% {
    transform: scale(0.75);
    opacity: 0.35;
  }
  50% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.75);
    opacity: 0.35;
  }
}

.aiConsoleActions {
  margin-left: auto;
  display: flex;
  gap: 8px;
}

.aiConsoleActions .ghostBtn {
  height: 32px;
  padding: 0 12px;
  border-radius: 10px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.76);
}

.aiConsoleActions .ghostBtn:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.96);
  border-color: rgba(37, 99, 235, 0.26);
}

.aiConsoleMeta {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
}

.aiMetaItem {
  min-width: 0;
  border: 1px solid rgba(15, 23, 42, 0.1);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.66);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.76);
  padding: 8px 10px;
}

.aiMetaLabel {
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 0.08em;
  font-weight: 700;
}

.aiMetaValue {
  margin-top: 4px;
  font-size: 12px;
  color: var(--fg1);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.aiChatFeed {
  flex: 1;
  min-height: 240px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin: 0;
  padding: 14px;
  overflow: auto;
  border-radius: 14px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: linear-gradient(180deg, rgba(243, 248, 255, 0.92), rgba(255, 255, 255, 0.94));
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.74), inset 0 -24px 32px rgba(15, 23, 42, 0.02);
}

.aiChatEmpty {
  color: var(--muted);
  font-size: 13px;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px dashed rgba(15, 23, 42, 0.18);
  background: rgba(255, 255, 255, 0.72);
  align-self: center;
}

.aiMsg {
  max-width: min(92%, 760px);
  padding: 9px 12px 10px;
  border-radius: 14px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.96);
  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
  font-size: 13px;
  line-height: 1.65;
  color: var(--fg0);
  white-space: pre-wrap;
  word-break: break-word;
  animation: aiMsgEnter 220ms cubic-bezier(0.2, 0.78, 0.2, 1) both;
}

.aiMsg--assistant {
  align-self: flex-start;
  border-color: rgba(37, 99, 235, 0.18);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(240, 247, 255, 0.95));
}

.aiMsg--user {
  align-self: flex-end;
  border-color: rgba(37, 99, 235, 0.34);
  background: linear-gradient(180deg, rgba(37, 99, 235, 0.14), rgba(14, 165, 233, 0.11));
}

.aiMsg--system {
  align-self: center;
  border-style: dashed;
  border-color: rgba(15, 23, 42, 0.2);
  background: rgba(15, 23, 42, 0.05);
  color: var(--muted);
  font-size: 12px;
}

.aiMsg--error {
  align-self: flex-start;
  border-color: rgba(209, 36, 47, 0.32);
  background: rgba(209, 36, 47, 0.08);
  color: #8a0f19;
}

.aiMsgRole {
  font-size: 10px;
  font-weight: 760;
  letter-spacing: 0.08em;
  margin-bottom: 4px;
  color: var(--muted);
}

.aiMsg--assistant .aiMsgRole {
  color: #1d4ed8;
}

.aiMsg--user .aiMsgRole {
  color: #0f4bb8;
}

.aiMsgBody {
  margin: 0;
}

@keyframes aiMsgEnter {
  0% {
    opacity: 0;
    transform: translateY(6px) scale(0.995);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.aiConsoleInputRow {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  align-items: stretch;
  border-radius: 14px;
  border: 1px solid rgba(37, 99, 235, 0.22);
  padding: 10px;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.78), rgba(244, 248, 255, 0.74));
  box-shadow: 0 10px 24px rgba(37, 99, 235, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.84);
}

.aiConsoleInput {
  min-height: 88px;
  max-height: 240px;
  resize: vertical;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.96);
  padding: 10px 12px;
  outline: none;
  font-size: 13px;
  line-height: 1.5;
}

.aiConsoleInput:focus {
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.14);
}

.aiSendBtn {
  align-self: stretch;
  min-width: 92px;
}

.appError {
  border: 1px solid rgba(209, 36, 47, 0.22);
  background: rgba(209, 36, 47, 0.06);
  color: #8a0f19;
  border-radius: 12px;
  padding: 10px 12px;
  font-size: 13px;
  margin-bottom: 12px;
}

.composer {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.composerTop {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.composerTopCompact {
  justify-content: flex-end;
}

.composerActions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.composerTitle {
  font-weight: 760;
  letter-spacing: -0.01em;
  margin: 2px 0 2px;
}

.composerError {
  border: 1px solid rgba(209, 36, 47, 0.22);
  background: rgba(209, 36, 47, 0.06);
  color: #8a0f19;
  border-radius: 12px;
  padding: 10px 12px;
  font-size: 13px;
}

.primaryBtn {
  height: 36px;
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid rgba(37, 99, 235, 0.28);
  background: linear-gradient(135deg, rgba(37, 99, 235, 0.96), rgba(6, 182, 212, 0.9));
  color: white;
  font-weight: 720;
  cursor: pointer;
  box-shadow: 0 14px 30px rgba(37, 99, 235, 0.18);
  transition: transform 140ms ease, box-shadow 140ms ease, filter 140ms ease;
}

.primaryBtn:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 18px 44px rgba(37, 99, 235, 0.22);
  filter: saturate(1.02);
}

.primaryBtn:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 12px 28px rgba(37, 99, 235, 0.18);
}

.primaryBtn:disabled {
  cursor: not-allowed;
  opacity: 0.6;
  box-shadow: none;
}

.tagInputWrap {
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.16);
  border-radius: var(--radius);
  padding: 10px 12px;
  box-shadow: var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(34px) saturate(1.28);
  transition: box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.tagInputWrap:focus-within {
  border-color: rgba(37, 99, 235, 0.22);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1), var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.tagInputLabel {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 8px;
}

.tagChips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.tagPicker {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(15, 23, 42, 0.08);
}

.tagPickerTop {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.tagPickerTitle {
  font-size: 12px;
  color: var(--muted);
  font-weight: 720;
  white-space: nowrap;
}

.tagPickerSearch {
  position: relative;
  flex: 1;
  max-width: 320px;
}

.tagPickerInput {
  width: 100%;
  height: 34px;
  padding: 0 36px 0 12px;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.78);
  font-size: 13px;
  outline: none;
  transition: box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.tagPickerInput:focus {
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
}

.tagPickerClear {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  width: 26px;
  height: 26px;
  border-radius: 10px;
  border: 0;
  background: rgba(15, 23, 42, 0.06);
  color: var(--fg1);
  cursor: pointer;
}

.tagPickerClear:hover {
  background: rgba(15, 23, 42, 0.1);
}

.tagPickerList {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  max-height: 120px;
  overflow: auto;
  margin-top: 10px;
  padding: 6px;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.08);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.08));
  backdrop-filter: blur(22px) saturate(1.2);
}

.tagPickerEmpty {
  color: var(--muted);
  font-size: 12px;
  padding: 6px;
}

.tagPickerMore {
  margin-top: 10px;
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.16);
  color: var(--fg1);
  padding: 6px 10px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 12px;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.tagPickerMore:hover {
  background: rgba(15, 23, 42, 0.06);
  transform: translateY(-1px);
}

.tagSuggestionPill {
  border: 1px dashed rgba(6, 182, 212, 0.28);
  background: rgba(6, 182, 212, 0.06);
  color: var(--tagFg);
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  cursor: pointer;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.tagSuggestionPill:hover {
  background: rgba(6, 182, 212, 0.12);
  transform: translateY(-1px);
}

.tagChip {
  display: inline-flex;
  gap: 8px;
  align-items: center;
  padding: 5px 10px;
  border-radius: 999px;
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(18px) saturate(1.15);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3);
  font-size: 12px;
}

.tagChipRemove {
  border: 0;
  background: transparent;
  color: rgba(15, 23, 42, 0.62);
  cursor: pointer;
  padding: 0;
  width: 18px;
  height: 18px;
  border-radius: 999px;
}

.tagChipRemove:hover {
  background: rgba(15, 23, 42, 0.08);
  color: var(--danger);
}

.tagInput {
  flex: 1;
  min-width: 180px;
  border: 0;
  outline: none;
  font-size: 13px;
  background: transparent;
  padding: 6px 2px;
}

.composerGrid {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
  gap: 12px;
}

.pane {
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.14);
  border-radius: var(--radius);
  overflow: hidden;
  min-height: 210px;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.28);
  backdrop-filter: blur(40px) saturate(1.3);
  transition: box-shadow 140ms ease, border-color 140ms ease, background 140ms ease;
}

.paneWrite {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.08));
}

.panePreview {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.07));
}

.pane:focus-within {
  border-color: rgba(37, 99, 235, 0.22);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1), var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.64);
}

.paneTitle {
  padding: 10px 12px;
  font-size: 12px;
  font-weight: 720;
  color: var(--muted);
  border-bottom: 1px solid rgba(15, 23, 42, 0.08);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.07));
}

.editor {
  width: 100%;
  flex: 1;
  min-height: 320px;
  max-height: 520px;
  resize: none;
  border: 1px solid rgba(15, 23, 42, 0.08);
  outline: none;
  background: rgba(255, 255, 255, 0.72);
  backdrop-filter: blur(26px) saturate(1.2);
  padding: 12px;
  font-size: 13px;
  line-height: 1.6;
  font-family: var(--mono);
  color: var(--fg0);
  -webkit-text-fill-color: var(--fg0);
  caret-color: var(--fg0);
  tab-size: 2;
  -moz-tab-size: 2;
}

.editor::selection {
  background: rgba(37, 99, 235, 0.22);
  color: var(--fg0);
  -webkit-text-fill-color: var(--fg0);
}

.paneWrite:focus-within .editor {
  border-color: rgba(37, 99, 235, 0.22);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.08);
}

.previewWrap {
  position: relative;
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
}

.preview {
  flex: 1;
  min-height: 320px;
  max-height: 520px;
  padding: 12px;
  overflow: auto;
  padding-bottom: 64px;
}

.previewActions {
  position: absolute;
  right: 12px;
  bottom: 12px;
  display: flex;
  gap: 10px;
  align-items: center;
  padding: 8px;
  border-radius: 999px;
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.18);
  backdrop-filter: blur(32px) saturate(1.25);
  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.28);
}

.settingsFab {
  position: fixed;
  left: 16px;
  bottom: 16px;
  z-index: 60;
  height: 40px;
  padding: 0 14px;
  border-radius: 999px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.18);
  color: var(--fg1);
  cursor: pointer;
  font-size: 12px;
  font-weight: 760;
  backdrop-filter: blur(32px) saturate(1.25);
  box-shadow: var(--shadowSm), inset 0 1px 0 rgba(255, 255, 255, 0.28);
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease, box-shadow 140ms ease;
}

.settingsFab:hover {
  background: rgba(255, 255, 255, 0.26);
  border-color: rgba(15, 23, 42, 0.18);
  transform: translateY(-1px);
  box-shadow: var(--shadow), inset 0 1px 0 rgba(255, 255, 255, 0.28);
}

.settingsFab:active {
  transform: translateY(0);
  box-shadow: var(--shadowSm);
}

.modalOverlay {
  position: fixed;
  inset: 0;
  z-index: 70;
  display: flex;
  align-items: flex-end;
  justify-content: flex-start;
  padding: 16px;
  background: rgba(15, 23, 42, 0.18);
  backdrop-filter: blur(16px);
}

.modalCard {
  width: min(520px, calc(100vw - 32px));
  max-height: calc(100vh - 32px);
  overflow: auto;
  border-radius: 16px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.24);
  backdrop-filter: blur(44px) saturate(1.35);
  box-shadow: var(--shadowLg), inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.modalHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(15, 23, 42, 0.08);
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.22), rgba(255, 255, 255, 0.1));
}

.modalTitle {
  font-weight: 800;
  letter-spacing: -0.01em;
}

.modalClose {
  width: 34px;
  height: 34px;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.12);
  background: rgba(255, 255, 255, 0.16);
  backdrop-filter: blur(18px) saturate(1.15);
  color: var(--fg1);
  cursor: pointer;
  transition: transform 140ms ease, background 140ms ease, border-color 140ms ease;
}

.modalClose:hover {
  background: rgba(15, 23, 42, 0.06);
  transform: translateY(-1px);
}

.modalBody {
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.settingBlock {
  border: 1px solid rgba(15, 23, 42, 0.1);
  background: rgba(255, 255, 255, 0.14);
  backdrop-filter: blur(24px) saturate(1.2);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.28);
  border-radius: 14px;
  padding: 12px;
}

.settingLabel {
  font-size: 12px;
  color: var(--muted);
  font-weight: 760;
  letter-spacing: 0.04em;
  margin-bottom: 8px;
}

.settingRow {
  display: flex;
  gap: 10px;
  align-items: center;
}

.settingCol {
  margin-top: 12px;
}

.settingSubLabel {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
}

.settingTextInput {
  width: 100%;
  height: 38px;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.94);
  font-size: 13px;
  padding: 0 10px;
  outline: none;
}

.settingTextInput:focus {
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
}

.settingTextarea {
  width: 100%;
  min-height: 160px;
  resize: vertical;
  border-radius: 12px;
  border: 1px solid rgba(15, 23, 42, 0.14);
  background: rgba(255, 255, 255, 0.94);
  font-size: 13px;
  line-height: 1.6;
  padding: 10px;
  outline: none;
}

.settingTextarea:focus {
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.12);
}

.settingActions {
  margin-top: 10px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.settingValue {
  flex: 1;
  min-width: 0;
  font-family: var(--mono);
  font-size: 12px;
  color: var(--fg1);
  border: 1px solid rgba(15, 23, 42, 0.08);
  background: rgba(255, 255, 255, 0.18);
  backdrop-filter: blur(18px) saturate(1.15);
  border-radius: 12px;
  padding: 8px 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.settingHint {
  color: var(--muted);
  font-size: 12px;
  line-height: 1.6;
  padding: 0 4px;
}

/* noApi */
.noApi {
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.noApiCard {
  border: 1px solid rgba(18, 26, 40, 0.12);
  background: rgba(255, 255, 255, 0.2);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 18px 18px;
  max-width: 560px;
}

.noApiTitle {
  font-weight: 800;
  margin-bottom: 6px;
}

.noApiBody {
  color: var(--muted);
  line-height: 1.6;
  font-size: 13px;
  font-family: var(--mono);
}

/* Opaque, modern UI theme */
:root {
  --bg0: #eef4ff;
  --bg1: #ffffff;
  --fg0: #0f172a;
  --fg1: #334155;
  --muted: #64748b;
  --accent: #2563eb;
  --accent2: #0891b2;
  --tagBg: #e0f2fe;
  --tagFg: #0c4a6e;
  --border: #cfd8e5;
  --borderSoft: #dde6f1;
}

.sidebar,
.topbar,
.composerArea,
.commentCard,
.pane,
.paneWrite,
.panePreview,
.paneTitle,
.modalCard,
.settingBlock,
.tagInputWrap,
.tagPickerList,
.noApiCard {
  background: #ffffff !important;
  border-color: var(--borderSoft) !important;
  backdrop-filter: none !important;
}

.topbar,
.composerArea,
.sidebar {
  box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06) !important;
}

.searchInput,
.tagSearchInput,
.tagPickerInput,
.editor,
.settingValue {
  background: #f8fbff !important;
  border-color: var(--borderSoft) !important;
  backdrop-filter: none !important;
  box-shadow: none !important;
}

.ghostBtn,
.dangerGhostBtn,
.limitPicker,
.datePicker,
.tagGroupHeader,
.previewActions,
.settingsFab,
.modalClose,
.tagChip,
.tagPickerMore,
.tagCount {
  background: #f3f7ff !important;
  border-color: var(--borderSoft) !important;
  backdrop-filter: none !important;
  box-shadow: none !important;
}

.tagItem {
  background: #ffffff !important;
  border-color: transparent !important;
}

.tagItem:hover {
  background: #f6f9ff !important;
  border-color: var(--borderSoft) !important;
}

.tagItem.isSelected,
.tagGroupHeader.isActive {
  background: #e9f1ff !important;
  border-color: #bcd2ff !important;
}

.commentHeader,
.modalHeader {
  background: #f8fbff !important;
}

.modalOverlay {
  background: #1e293b;
  backdrop-filter: none;
}

/* Journal-side visual refresh */
.sidebar,
.topbar,
.composerArea {
  background:
    radial-gradient(960px 340px at -14% -26%, rgba(37, 99, 235, 0.16), rgba(37, 99, 235, 0) 64%),
    radial-gradient(840px 300px at 112% -22%, rgba(6, 182, 212, 0.14), rgba(6, 182, 212, 0) 66%),
    linear-gradient(180deg, #ffffff, #f7fbff) !important;
  border-color: #d5e1f0 !important;
  box-shadow: 0 16px 36px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.9) !important;
}

.scrollArea {
  background:
    radial-gradient(1100px 340px at 52% -22%, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0) 68%),
    radial-gradient(960px 300px at 6% -18%, rgba(6, 182, 212, 0.06), rgba(6, 182, 212, 0) 72%);
}

.commentList {
  width: 100%;
  max-width: 1120px;
  margin: 0 auto;
}

.commentCard {
  border-color: transparent !important;
  background:
    linear-gradient(180deg, rgba(255, 255, 255, 0.98), rgba(247, 251, 255, 0.96)) padding-box,
    linear-gradient(135deg, rgba(37, 99, 235, 0.34), rgba(6, 182, 212, 0.2), rgba(15, 23, 42, 0.08))
      border-box !important;
  box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12), 0 1px 0 rgba(255, 255, 255, 0.82) inset !important;
}

.commentCard:hover {
  box-shadow: 0 20px 42px rgba(15, 23, 42, 0.16), 0 1px 0 rgba(255, 255, 255, 0.86) inset !important;
}

.commentHeader {
  background: linear-gradient(180deg, #fcfeff, #f2f7ff) !important;
  border-bottom-color: rgba(15, 23, 42, 0.08) !important;
}

.commentBody {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.72), rgba(248, 251, 255, 0.82));
}

.searchInput,
.tagSearchInput,
.tagPickerInput {
  background: linear-gradient(180deg, #ffffff, #f5f9ff) !important;
  border-color: #d4dfef !important;
  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.9) !important;
}

.limitPicker,
.datePicker {
  background: linear-gradient(180deg, #ffffff, #eff5ff) !important;
  border-color: #d2deee !important;
  box-shadow: 0 8px 18px rgba(15, 23, 42, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.86) !important;
}

.sidebar .tagGroupHeader,
.sidebar .tagCount,
.sidebar .tagChip,
.sidebar .tagPickerMore {
  background: linear-gradient(180deg, #ffffff, #f1f6ff) !important;
  border-color: #d4dfef !important;
  box-shadow: 0 6px 14px rgba(15, 23, 42, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.84) !important;
}

.sidebar .tagItem {
  background: linear-gradient(180deg, #ffffff, #fbfdff) !important;
}

.sidebar .tagItem:hover {
  background: linear-gradient(180deg, #f8fbff, #f1f7ff) !important;
}

.sidebar .tagItem.isSelected,
.sidebar .tagGroupHeader.isActive {
  background: linear-gradient(180deg, #ebf3ff, #deebff) !important;
  border-color: #aecbfb !important;
}

.composerArea .tagInputWrap,
.composerArea .pane,
.composerArea .paneWrite,
.composerArea .panePreview,
.composerArea .paneTitle,
.composerArea .tagPickerList {
  background: linear-gradient(180deg, #ffffff, #f7fbff) !important;
  border-color: #d5e1f0 !important;
  box-shadow: 0 12px 26px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.88) !important;
}

.editor {
  background: linear-gradient(180deg, #ffffff, #f7fbff) !important;
  border-color: #d5e1f0 !important;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.88) !important;
}

.paneWrite:focus-within .editor {
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.14), inset 0 1px 0 rgba(255, 255, 255, 0.88) !important;
}

.previewActions,
.settingsFab,
.commentCard .ghostBtn,
.commentCard .dangerGhostBtn {
  background: linear-gradient(180deg, #ffffff, #eef4ff) !important;
  border-color: #d1deef !important;
  box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.86) !important;
}

/* Theme presets (selectable from settings) */
:root {
  --theme-bg-color: #eef4ff;
  --theme-bg-gradient: linear-gradient(180deg, #eef4ff 0%, #f7faff 52%, #f3f7fd 100%);
  --theme-surface: #ffffff;
  --theme-surface-alt: #f7fbff;
  --theme-surface-soft: #f3f7ff;
  --theme-surface-soft-2: #eef4ff;
  --theme-surface-selected: #ebf3ff;
  --theme-text: #0f172a;
  --theme-text-subtle: #334155;
  --theme-text-muted: #64748b;
  --theme-border: #cfd8e5;
  --theme-border-soft: #dde6f1;
  --theme-border-strong: #d5e1f0;
  --theme-border-selected: #aecbfb;
  --theme-accent: #2563eb;
  --theme-accent2: #0891b2;
  --theme-danger: #d1242f;
  --theme-overlay: #1e293b;
  --theme-tag-bg: #e0f2fe;
  --theme-tag-fg: #0c4a6e;
  --theme-code-bg: #f6f8fa;
  --theme-code-bg-soft: #f1f5f9;
  --theme-code-border: #d0d7de;
  --theme-code-fg: #1f2937;
  --theme-code-muted: #6b7280;
  --theme-code-keyword: #c0263d;
  --theme-code-title: #6d28d9;
  --theme-code-literal: #0b6fc2;
  --theme-code-string: #0f766e;
  --theme-code-builtin: #b45309;
  --theme-code-tag: #15803d;
  --theme-code-addition: #166534;
  --theme-code-addition-bg: #dcfce7;
  --theme-code-deletion: #991b1b;
  --theme-code-deletion-bg: #fee2e2;

  --theme-accent-rgb: 37, 99, 235;
  --theme-accent2-rgb: 8, 145, 178;
  --theme-danger-rgb: 209, 36, 47;
  --theme-shadow-rgb: 15, 23, 42;

  --theme-shell-accent: rgba(37, 99, 235, 0.16);
  --theme-shell-accent2: rgba(8, 145, 178, 0.14);
  --theme-scroll-accent: rgba(37, 99, 235, 0.08);
  --theme-scroll-accent2: rgba(8, 145, 178, 0.06);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(37, 99, 235, 0.34),
    rgba(8, 145, 178, 0.2),
    rgba(15, 23, 42, 0.08)
  );
}

[data-acta-theme="dracula"] {
  --theme-bg-color: #282a36;
  --theme-bg-gradient: linear-gradient(180deg, #282a36 0%, #242632 52%, #20222b 100%);
  --theme-surface: #2f3142;
  --theme-surface-alt: #34364a;
  --theme-surface-soft: #3a3d52;
  --theme-surface-soft-2: #353a52;
  --theme-surface-selected: #3c4161;
  --theme-text: #f8f8f2;
  --theme-text-subtle: #e3e2f0;
  --theme-text-muted: #b7b4cb;
  --theme-border: #44475a;
  --theme-border-soft: #50546b;
  --theme-border-strong: #5c6180;
  --theme-border-selected: #bd93f9;
  --theme-accent: #bd93f9;
  --theme-accent2: #8be9fd;
  --theme-danger: #ff5555;
  --theme-overlay: #151720;
  --theme-tag-bg: #3b3558;
  --theme-tag-fg: #f0cbff;
  --theme-accent-rgb: 189, 147, 249;
  --theme-accent2-rgb: 139, 233, 253;
  --theme-danger-rgb: 255, 85, 85;
  --theme-shadow-rgb: 7, 8, 12;
  --theme-shell-accent: rgba(189, 147, 249, 0.2);
  --theme-shell-accent2: rgba(139, 233, 253, 0.16);
  --theme-scroll-accent: rgba(189, 147, 249, 0.12);
  --theme-scroll-accent2: rgba(139, 233, 253, 0.08);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(189, 147, 249, 0.5),
    rgba(139, 233, 253, 0.2),
    rgba(248, 248, 242, 0.12)
  );
}

[data-acta-theme="solarized-dark"] {
  --theme-bg-color: #002b36;
  --theme-bg-gradient: linear-gradient(180deg, #002b36 0%, #073642 52%, #0a3340 100%);
  --theme-surface: #073642;
  --theme-surface-alt: #0b3d49;
  --theme-surface-soft: #114a58;
  --theme-surface-soft-2: #0f4452;
  --theme-surface-selected: #145060;
  --theme-text: #eee8d5;
  --theme-text-subtle: #93a1a1;
  --theme-text-muted: #839496;
  --theme-border: #365965;
  --theme-border-soft: #446773;
  --theme-border-strong: #567b87;
  --theme-border-selected: #2aa198;
  --theme-accent: #268bd2;
  --theme-accent2: #2aa198;
  --theme-danger: #dc322f;
  --theme-overlay: #001821;
  --theme-tag-bg: #12444f;
  --theme-tag-fg: #9fe3d8;
  --theme-accent-rgb: 38, 139, 210;
  --theme-accent2-rgb: 42, 161, 152;
  --theme-danger-rgb: 220, 50, 47;
  --theme-shadow-rgb: 0, 18, 24;
  --theme-shell-accent: rgba(38, 139, 210, 0.18);
  --theme-shell-accent2: rgba(42, 161, 152, 0.18);
  --theme-scroll-accent: rgba(38, 139, 210, 0.12);
  --theme-scroll-accent2: rgba(42, 161, 152, 0.1);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(38, 139, 210, 0.45),
    rgba(42, 161, 152, 0.28),
    rgba(238, 232, 213, 0.16)
  );
}

[data-acta-theme="solarized-light"] {
  --theme-bg-color: #fdf6e3;
  --theme-bg-gradient: linear-gradient(180deg, #fdf6e3 0%, #f8f1df 52%, #f7efdc 100%);
  --theme-surface: #fffdf5;
  --theme-surface-alt: #f7f1de;
  --theme-surface-soft: #f3ecd8;
  --theme-surface-soft-2: #efe7d1;
  --theme-surface-selected: #e9dfc7;
  --theme-text: #073642;
  --theme-text-subtle: #586e75;
  --theme-text-muted: #657b83;
  --theme-border: #d6ccb2;
  --theme-border-soft: #dfd5bc;
  --theme-border-strong: #c8bea5;
  --theme-border-selected: #b58900;
  --theme-accent: #268bd2;
  --theme-accent2: #2aa198;
  --theme-danger: #dc322f;
  --theme-overlay: #1f2f38;
  --theme-tag-bg: #e4f2ef;
  --theme-tag-fg: #0e6f67;
  --theme-accent-rgb: 38, 139, 210;
  --theme-accent2-rgb: 42, 161, 152;
  --theme-danger-rgb: 220, 50, 47;
  --theme-shadow-rgb: 36, 43, 50;
  --theme-shell-accent: rgba(38, 139, 210, 0.14);
  --theme-shell-accent2: rgba(42, 161, 152, 0.12);
  --theme-scroll-accent: rgba(38, 139, 210, 0.08);
  --theme-scroll-accent2: rgba(42, 161, 152, 0.06);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(38, 139, 210, 0.32),
    rgba(42, 161, 152, 0.24),
    rgba(88, 110, 117, 0.14)
  );
}

[data-acta-theme="morokai"] {
  --theme-bg-color: #272822;
  --theme-bg-gradient: linear-gradient(180deg, #272822 0%, #232420 52%, #1f201c 100%);
  --theme-surface: #2d2e27;
  --theme-surface-alt: #33342c;
  --theme-surface-soft: #3b3c33;
  --theme-surface-soft-2: #44463c;
  --theme-surface-selected: #4a4d3f;
  --theme-text: #f8f8f2;
  --theme-text-subtle: #d8d8c9;
  --theme-text-muted: #a7aa95;
  --theme-border: #4a4d3f;
  --theme-border-soft: #575b4a;
  --theme-border-strong: #646955;
  --theme-border-selected: #a6e22e;
  --theme-accent: #66d9ef;
  --theme-accent2: #a6e22e;
  --theme-danger: #f92672;
  --theme-overlay: #12130f;
  --theme-tag-bg: #39412d;
  --theme-tag-fg: #d9f9a4;
  --theme-accent-rgb: 102, 217, 239;
  --theme-accent2-rgb: 166, 226, 46;
  --theme-danger-rgb: 249, 38, 114;
  --theme-shadow-rgb: 7, 8, 6;
  --theme-shell-accent: rgba(102, 217, 239, 0.14);
  --theme-shell-accent2: rgba(166, 226, 46, 0.13);
  --theme-scroll-accent: rgba(102, 217, 239, 0.1);
  --theme-scroll-accent2: rgba(166, 226, 46, 0.07);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(102, 217, 239, 0.38),
    rgba(166, 226, 46, 0.28),
    rgba(248, 248, 242, 0.14)
  );
}

[data-acta-theme="morokai-light"] {
  --theme-bg-color: #f8f7f1;
  --theme-bg-gradient: linear-gradient(180deg, #f8f7f1 0%, #f2f0e6 52%, #efecdf 100%);
  --theme-surface: #fffef7;
  --theme-surface-alt: #f5f3e8;
  --theme-surface-soft: #efebda;
  --theme-surface-soft-2: #ebe6d2;
  --theme-surface-selected: #e3ddc4;
  --theme-text: #2f3228;
  --theme-text-subtle: #4b5142;
  --theme-text-muted: #68705e;
  --theme-border: #d5d2c4;
  --theme-border-soft: #e1ded0;
  --theme-border-strong: #c7c3b2;
  --theme-border-selected: #8bb23f;
  --theme-accent: #2c8fa3;
  --theme-accent2: #7aa12f;
  --theme-danger: #d14b6c;
  --theme-overlay: #2b2e24;
  --theme-tag-bg: #e3edd2;
  --theme-tag-fg: #4d6120;
  --theme-accent-rgb: 44, 143, 163;
  --theme-accent2-rgb: 122, 161, 47;
  --theme-danger-rgb: 209, 75, 108;
  --theme-shadow-rgb: 37, 39, 32;
  --theme-shell-accent: rgba(44, 143, 163, 0.14);
  --theme-shell-accent2: rgba(122, 161, 47, 0.1);
  --theme-scroll-accent: rgba(44, 143, 163, 0.08);
  --theme-scroll-accent2: rgba(122, 161, 47, 0.06);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(44, 143, 163, 0.32),
    rgba(122, 161, 47, 0.26),
    rgba(47, 50, 40, 0.12)
  );
}

[data-acta-theme="tokyo-night"] {
  --theme-bg-color: #1a1b26;
  --theme-bg-gradient: linear-gradient(180deg, #1a1b26 0%, #1d2030 52%, #202438 100%);
  --theme-surface: #1f2335;
  --theme-surface-alt: #24283b;
  --theme-surface-soft: #2a2f45;
  --theme-surface-soft-2: #303751;
  --theme-surface-selected: #333d5f;
  --theme-text: #c0caf5;
  --theme-text-subtle: #a9b1d6;
  --theme-text-muted: #7f89b0;
  --theme-border: #3b4261;
  --theme-border-soft: #4a5278;
  --theme-border-strong: #5b6490;
  --theme-border-selected: #7aa2f7;
  --theme-accent: #7aa2f7;
  --theme-accent2: #2ac3de;
  --theme-danger: #f7768e;
  --theme-overlay: #0d0e14;
  --theme-tag-bg: #293456;
  --theme-tag-fg: #9ab8ff;
  --theme-accent-rgb: 122, 162, 247;
  --theme-accent2-rgb: 42, 195, 222;
  --theme-danger-rgb: 247, 118, 142;
  --theme-shadow-rgb: 7, 9, 15;
  --theme-shell-accent: rgba(122, 162, 247, 0.18);
  --theme-shell-accent2: rgba(42, 195, 222, 0.16);
  --theme-scroll-accent: rgba(122, 162, 247, 0.12);
  --theme-scroll-accent2: rgba(42, 195, 222, 0.08);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(122, 162, 247, 0.5),
    rgba(42, 195, 222, 0.3),
    rgba(192, 202, 245, 0.16)
  );
}

[data-acta-theme="nord"] {
  --theme-bg-color: #2e3440;
  --theme-bg-gradient: linear-gradient(180deg, #2e3440 0%, #313846 52%, #343c4d 100%);
  --theme-surface: #3b4252;
  --theme-surface-alt: #434c5e;
  --theme-surface-soft: #4c566a;
  --theme-surface-soft-2: #58647d;
  --theme-surface-selected: #616f8c;
  --theme-text: #eceff4;
  --theme-text-subtle: #d8dee9;
  --theme-text-muted: #b8c0d0;
  --theme-border: #5c677d;
  --theme-border-soft: #67748f;
  --theme-border-strong: #7a88a5;
  --theme-border-selected: #88c0d0;
  --theme-accent: #81a1c1;
  --theme-accent2: #88c0d0;
  --theme-danger: #bf616a;
  --theme-overlay: #1f2631;
  --theme-tag-bg: #4b5973;
  --theme-tag-fg: #d6e6f5;
  --theme-accent-rgb: 129, 161, 193;
  --theme-accent2-rgb: 136, 192, 208;
  --theme-danger-rgb: 191, 97, 106;
  --theme-shadow-rgb: 18, 22, 30;
  --theme-shell-accent: rgba(129, 161, 193, 0.18);
  --theme-shell-accent2: rgba(136, 192, 208, 0.14);
  --theme-scroll-accent: rgba(129, 161, 193, 0.1);
  --theme-scroll-accent2: rgba(136, 192, 208, 0.08);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(129, 161, 193, 0.46),
    rgba(136, 192, 208, 0.3),
    rgba(236, 239, 244, 0.15)
  );
}

[data-acta-theme="gruvbox-dark"] {
  --theme-bg-color: #282828;
  --theme-bg-gradient: linear-gradient(180deg, #282828 0%, #242322 52%, #20201f 100%);
  --theme-surface: #32302f;
  --theme-surface-alt: #3a3735;
  --theme-surface-soft: #45403d;
  --theme-surface-soft-2: #504945;
  --theme-surface-selected: #5b534d;
  --theme-text: #ebdbb2;
  --theme-text-subtle: #d5c4a1;
  --theme-text-muted: #bdae93;
  --theme-border: #665c54;
  --theme-border-soft: #7c6f64;
  --theme-border-strong: #928374;
  --theme-border-selected: #d79921;
  --theme-accent: #458588;
  --theme-accent2: #b8bb26;
  --theme-danger: #fb4934;
  --theme-overlay: #1d2021;
  --theme-tag-bg: #4f4a41;
  --theme-tag-fg: #f2e5bc;
  --theme-accent-rgb: 69, 133, 136;
  --theme-accent2-rgb: 184, 187, 38;
  --theme-danger-rgb: 251, 73, 52;
  --theme-shadow-rgb: 11, 11, 10;
  --theme-shell-accent: rgba(69, 133, 136, 0.18);
  --theme-shell-accent2: rgba(184, 187, 38, 0.14);
  --theme-scroll-accent: rgba(69, 133, 136, 0.1);
  --theme-scroll-accent2: rgba(184, 187, 38, 0.07);
  --theme-card-border-gradient: linear-gradient(
    135deg,
    rgba(69, 133, 136, 0.44),
    rgba(184, 187, 38, 0.28),
    rgba(235, 219, 178, 0.15)
  );
}

:root,
[data-acta-theme] {
  --bg0: var(--theme-bg-color);
  --bg1: var(--theme-surface);
  --fg0: var(--theme-text);
  --fg1: var(--theme-text-subtle);
  --muted: var(--theme-text-muted);
  --accent: var(--theme-accent);
  --accent2: var(--theme-accent2);
  --tagBg: var(--theme-tag-bg);
  --tagFg: var(--theme-tag-fg);
  --danger: var(--theme-danger);
  --border: var(--theme-border);
  --borderSoft: var(--theme-border-soft);
}

body {
  color: var(--theme-text) !important;
  background-color: var(--theme-bg-color) !important;
  background-image: var(--theme-bg-gradient) !important;
}

.sidebar,
.topbar,
.composerArea {
  background:
    radial-gradient(960px 340px at -14% -26%, var(--theme-shell-accent), transparent 64%),
    radial-gradient(840px 300px at 112% -22%, var(--theme-shell-accent2), transparent 66%),
    linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  border-color: var(--theme-border-strong) !important;
  box-shadow: 0 16px 36px rgba(var(--theme-shadow-rgb), 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.22) !important;
}

.scrollArea {
  background:
    radial-gradient(1100px 340px at 52% -22%, var(--theme-scroll-accent), transparent 68%),
    radial-gradient(960px 300px at 6% -18%, var(--theme-scroll-accent2), transparent 72%);
}

.commentCard {
  border-color: transparent !important;
  background:
    linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) padding-box,
    var(--theme-card-border-gradient) border-box !important;
  box-shadow: 0 14px 30px rgba(var(--theme-shadow-rgb), 0.26), 0 1px 0 rgba(255, 255, 255, 0.16) inset !important;
}

.commentCard:hover {
  box-shadow: 0 20px 42px rgba(var(--theme-shadow-rgb), 0.3), 0 1px 0 rgba(255, 255, 255, 0.2) inset !important;
}

.commentHeader,
.modalHeader {
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  border-bottom-color: var(--theme-border-soft) !important;
}

.commentBody {
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt));
}

.searchInput,
.tagSearchInput,
.tagPickerInput,
.editor,
.settingValue,
.settingTextInput,
.settingTextarea {
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  border-color: var(--theme-border-strong) !important;
  color: var(--theme-text) !important;
  box-shadow: 0 8px 18px rgba(var(--theme-shadow-rgb), 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}

.ghostBtn,
.dangerGhostBtn,
.limitPicker,
.datePicker,
.tagGroupHeader,
.previewActions,
.settingsFab,
.modalClose,
.tagChip,
.tagPickerMore,
.tagCount {
  background: linear-gradient(180deg, var(--theme-surface-soft), var(--theme-surface-soft-2)) !important;
  border-color: var(--theme-border-soft) !important;
  color: var(--theme-text-subtle) !important;
  box-shadow: 0 10px 22px rgba(var(--theme-shadow-rgb), 0.16), inset 0 1px 0 rgba(255, 255, 255, 0.18) !important;
}

.tagItem,
.sidebar .tagItem {
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  border-color: transparent !important;
}

.tagItem:hover,
.sidebar .tagItem:hover {
  background: linear-gradient(180deg, var(--theme-surface-alt), var(--theme-surface-soft)) !important;
  border-color: var(--theme-border-soft) !important;
}

.tagItem.isSelected,
.tagGroupHeader.isActive,
.sidebar .tagItem.isSelected,
.sidebar .tagGroupHeader.isActive {
  background: linear-gradient(180deg, var(--theme-surface-selected), var(--theme-surface-soft-2)) !important;
  border-color: var(--theme-border-selected) !important;
}

.composerArea .tagInputWrap,
.composerArea .pane,
.composerArea .paneWrite,
.composerArea .panePreview,
.composerArea .paneTitle,
.composerArea .tagPickerList,
.modalCard,
.settingBlock,
.noApiCard,
.aiConsole,
.aiConsoleHeader,
.aiMetaItem,
.aiChatFeed,
.aiConsoleInputRow {
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  border-color: var(--theme-border-strong) !important;
  box-shadow: 0 12px 26px rgba(var(--theme-shadow-rgb), 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.18) !important;
}

.paneWrite:focus-within .editor {
  box-shadow: 0 0 0 4px rgba(var(--theme-accent-rgb), 0.24), inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}

.tagPill {
  background: var(--theme-tag-bg) !important;
  color: var(--theme-tag-fg) !important;
  border-color: rgba(var(--theme-accent2-rgb), 0.34) !important;
}

.modalOverlay {
  background: var(--theme-overlay) !important;
}

.aiConsoleStatus,
.aiThinking,
.aiMsgRole,
.aiMetaLabel,
.aiMetaValue,
.aiTopHint,
.settingHint,
.empty,
.tagEmpty {
  color: var(--theme-text-muted) !important;
}

.aiConsoleStatus.isLive {
  border-color: rgba(var(--theme-accent2-rgb), 0.4) !important;
  background: rgba(var(--theme-accent2-rgb), 0.16) !important;
  color: var(--theme-accent2) !important;
}

.aiThinking.isActive {
  border-color: rgba(var(--theme-accent-rgb), 0.38) !important;
  background: rgba(var(--theme-accent-rgb), 0.14) !important;
  color: var(--theme-accent) !important;
}

.aiMsg {
  border-color: var(--theme-border-soft) !important;
  background: linear-gradient(180deg, var(--theme-surface), var(--theme-surface-alt)) !important;
  color: var(--theme-text) !important;
}

.aiMsg--assistant {
  border-color: rgba(var(--theme-accent-rgb), 0.34) !important;
}

.aiMsg--user {
  border-color: rgba(var(--theme-accent-rgb), 0.45) !important;
  background: linear-gradient(
    180deg,
    rgba(var(--theme-accent-rgb), 0.2),
    rgba(var(--theme-accent2-rgb), 0.16)
  ) !important;
}

.aiMsg--system {
  border-color: var(--theme-border) !important;
  background: linear-gradient(180deg, var(--theme-surface-soft), var(--theme-surface-soft-2)) !important;
}

.aiMsg--error {
  border-color: rgba(var(--theme-danger-rgb), 0.55) !important;
  background: rgba(var(--theme-danger-rgb), 0.16) !important;
  color: var(--theme-danger) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  ) {
  --theme-code-bg: linear-gradient(
    180deg,
    rgba(var(--theme-shadow-rgb), 0.86),
    rgba(var(--theme-shadow-rgb), 0.72)
  );
  --theme-code-bg-soft: rgba(var(--theme-shadow-rgb), 0.54);
  --theme-code-border: rgba(255, 255, 255, 0.24);
  --theme-code-fg: rgba(245, 248, 255, 0.96);
  --theme-code-muted: rgba(198, 210, 232, 0.78);
  --theme-code-keyword: #fda4af;
  --theme-code-title: #c4b5fd;
  --theme-code-literal: #7dd3fc;
  --theme-code-string: #86efac;
  --theme-code-builtin: #fdba74;
  --theme-code-tag: #93c5fd;
  --theme-code-addition: #86efac;
  --theme-code-addition-bg: rgba(22, 163, 74, 0.22);
  --theme-code-deletion: #fca5a5;
  --theme-code-deletion-bg: rgba(220, 38, 38, 0.22);
}

/* Contrast tuning for dark themes */
:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .viewTab {
  background: linear-gradient(180deg, rgba(var(--theme-shadow-rgb), 0.44), rgba(var(--theme-shadow-rgb), 0.32)) !important;
  border-color: rgba(var(--theme-accent-rgb), 0.3) !important;
  color: rgba(255, 255, 255, 0.88) !important;
  box-shadow: 0 8px 18px rgba(var(--theme-shadow-rgb), 0.34), inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .viewTab:hover {
  background: linear-gradient(180deg, rgba(var(--theme-shadow-rgb), 0.52), rgba(var(--theme-shadow-rgb), 0.38)) !important;
  border-color: rgba(var(--theme-accent-rgb), 0.4) !important;
  color: #ffffff !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .viewTab.isActive {
  background: linear-gradient(135deg, rgba(var(--theme-accent-rgb), 0.84), rgba(var(--theme-accent2-rgb), 0.76)) !important;
  border-color: rgba(var(--theme-accent2-rgb), 0.6) !important;
  color: #ffffff !important;
  text-shadow: 0 1px 2px rgba(var(--theme-shadow-rgb), 0.28);
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(
      .ghostBtn,
      .dangerGhostBtn,
      .searchClear,
      .dateNavBtn,
      .dateQuickBtn,
      .dateClearBtn,
      .tagSearchClear,
      .tagPickerClear,
      .settingsFab,
      .modalClose
    ) {
  background: linear-gradient(180deg, rgba(var(--theme-shadow-rgb), 0.44), rgba(var(--theme-shadow-rgb), 0.32)) !important;
  border-color: rgba(var(--theme-accent-rgb), 0.26) !important;
  color: rgba(255, 255, 255, 0.9) !important;
  box-shadow: 0 10px 20px rgba(var(--theme-shadow-rgb), 0.32), inset 0 1px 0 rgba(255, 255, 255, 0.14) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(
      .ghostBtn:hover,
      .dangerGhostBtn:hover,
      .searchClear:hover,
      .dateNavBtn:hover,
      .dateQuickBtn:hover,
      .dateClearBtn:hover,
      .tagSearchClear:hover,
      .tagPickerClear:hover
    ) {
  background: linear-gradient(180deg, rgba(var(--theme-accent-rgb), 0.42), rgba(var(--theme-accent2-rgb), 0.3)) !important;
  border-color: rgba(var(--theme-accent2-rgb), 0.48) !important;
  color: #ffffff !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(.tagGroupHeader, .tagItem, .tagChip, .tagPickerMore, .tagPill, .tagSuggestionPill) {
  background: linear-gradient(180deg, rgba(var(--theme-shadow-rgb), 0.42), rgba(var(--theme-shadow-rgb), 0.3)) !important;
  border-color: rgba(var(--theme-accent-rgb), 0.28) !important;
  color: rgba(255, 255, 255, 0.92) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(.tagItem:hover, .tagGroupHeader:hover, .tagPill:hover, .tagSuggestionPill:hover) {
  background: linear-gradient(180deg, rgba(var(--theme-accent-rgb), 0.34), rgba(var(--theme-accent2-rgb), 0.24)) !important;
  border-color: rgba(var(--theme-accent2-rgb), 0.5) !important;
  color: #ffffff !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(.tagItem.isSelected, .tagGroupHeader.isActive) {
  background: linear-gradient(180deg, rgba(var(--theme-accent-rgb), 0.52), rgba(var(--theme-accent2-rgb), 0.36)) !important;
  border-color: rgba(var(--theme-accent2-rgb), 0.66) !important;
  color: #ffffff !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .tagCount {
  background: rgba(var(--theme-shadow-rgb), 0.58) !important;
  border-color: rgba(var(--theme-accent-rgb), 0.34) !important;
  color: rgba(255, 255, 255, 0.9) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(.tagItem.isSelected .tagCount, .tagGroupHeader.isActive .tagCount) {
  background: rgba(255, 255, 255, 0.16) !important;
  border-color: rgba(255, 255, 255, 0.4) !important;
  color: #ffffff !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .tagGroupHeader::before {
  border-right-color: rgba(255, 255, 255, 0.74) !important;
  border-bottom-color: rgba(255, 255, 255, 0.74) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  .tagGroupHeader.isActive::before {
  border-right-color: rgba(255, 255, 255, 0.95) !important;
  border-bottom-color: rgba(255, 255, 255, 0.95) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(.tagGroupName, .tagName, .limitLabel, .dateLabel, .dateInput, .limitSelect, .commentMeta, .settingLabel, .settingSubLabel) {
  color: rgba(255, 255, 255, 0.88) !important;
}

:is(
    [data-acta-theme="dracula"],
    [data-acta-theme="solarized-dark"],
    [data-acta-theme="morokai"],
    [data-acta-theme="tokyo-night"],
    [data-acta-theme="nord"],
    [data-acta-theme="gruvbox-dark"]
  )
  :is(input, textarea)::placeholder {
  color: rgba(255, 255, 255, 0.55) !important;
}

@media (prefers-reduced-motion: reduce) {
  .commentCard {
    animation: none;
    transition: none;
  }

  .tagItem,
  .tagGroupHeader,
  .ghostBtn,
  .primaryBtn,
  .tagPill,
  .dangerGhostBtn,
  .tagSuggestionPill,
  .tagPickerMore,
  .modalClose,
  .settingsFab {
    transition: none;
  }
}

@media (max-width: 980px) {
  .shell {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
  }
  .sidebar {
    border-right: 0;
    border-bottom: 1px solid var(--border);
    max-height: 220px;
  }
  .topbar {
    grid-template-columns: 1fr;
  }
  .topbarControls {
    max-width: none;
    flex-direction: column;
    align-items: stretch;
  }
  .search {
    max-width: none;
  }
  .limitPicker {
    justify-content: space-between;
  }
  .topbarRight {
    align-items: flex-start;
  }
  .composerGrid {
    grid-template-columns: 1fr;
  }
  .aiConsoleHeader {
    align-items: flex-start;
  }
  .aiConsoleActions {
    margin-left: 0;
    width: 100%;
    justify-content: flex-end;
    flex-wrap: wrap;
  }
  .aiConsoleMeta {
    grid-template-columns: 1fr;
  }
  .aiConsoleInputRow {
    grid-template-columns: 1fr;
  }
  .aiSendBtn {
    min-height: 40px;
  }
  .editor {
    min-height: 240px;
    max-height: 360px;
  }
  .preview {
    min-height: 240px;
    max-height: 360px;
  }
}
